# 実験名未定

## by nishio
heuristicsの各種パラメータを人間との対戦の棋譜を参考にして調整したい
task 1: logs/1.txtにコンソールからコピーした不完全な棋譜がある、どのタイミングでtakeしているかに注目して分析せよ
task 2: 元のheuristicsと、パラメータ調整したheuristics(v2)とで自己対戦して勝率が改善するのかどうかを観察せよ
task 3: コンソールからのコピーは不便なので、人間との対戦時にlogsに対戦時刻のファイル名で利用しやすい形のログを出力するようにせよ

## task1 result

logs/1.txt を解析（"Your move" 37回分）したメモ。

- TAKE 9回 / PASS 28回。TAKEはほぼ Δscore <= 0 で、例外は card=4 の +2 のみ。
- PASS は Δscore <= 0 でも複数回あり（良いカードでもミルクする傾向が強い）。
- TAKE は「ランを伸ばす局面（ΔcardPts 0 or -1）」か「十分チップが乗った後」に集中。
- card=11 は tokens_on_card 0/3/6 でPASS → 9でTAKE。積極的に待ってチップを積む判断。

### TAKE一覧（要約）

| card | tokens_on_card | Δscore | メモ |
| --- | --- | --- | --- |
| 4 | 2 | +2 | 低カード確保 |
| 5 | 5 | -5 | 4-5のラン確定 |
| 16 | 16 | 0 | チップ十分で回収 |
| 11 | 9 | -9 | 10-11のラン / milk後 |
| 27 | 0 | -1 | 27-28のラン |
| 12 | 0 | 0 | 10-12のラン |
| 15 | 4 | -5 | 15-16のラン |
| 26 | 1 | -2 | 26-28のラン |
| 6 | 3 | -3 | 4-6のラン |

調整の方向性（次タスクの前提）:  
「良いカードでも相手が欲しがらないときはPASSしてチップを積む」傾向が強い。  
現行heuristicの milking が弱いので、milking 関連パラメータを上げる方針。

## task2 result

v2 = `heuristic2` として、milking 強化版のパラメータを作成。

- 変更: `milk_max_tokens_on_card = 9`（その他はv1と同じ）

自己対戦（seed=1, games=3000, 3座席ローテ）:

- `--ai heuristic heuristic2 greedy`  
  - v1 winrate 42.83% / v2 winrate 41.97% / greedy 15.20%
- `--ai heuristic2 heuristic greedy`  
  - v2 winrate 56.10% / v1 winrate 29.80% / greedy 14.10%
- `--ai heuristic2 greedy heuristic`  
  - v2 winrate 43.18% / v1 winrate 42.52% / greedy 14.30%

3条件平均（座席の偏りならすための簡易平均）:

- v2 約47.1% / v1 約38.4% / greedy 約14.5%

所感: v2 は「平均的には少し有利」に見えるが、座席/seed依存が大きそうなので追加検証余地あり。

### 追加実験: `heuristic`×2 + `heuristic2`（三通り）

- `--ai heuristic heuristic heuristic2`  
  - v1 winrate 28.73% / 29.68% / v2 winrate 41.59%
- `--ai heuristic heuristic2 heuristic`  
  - v1 winrate 29.58% / 28.46% / v2 winrate 41.96%
- `--ai heuristic2 heuristic heuristic`  
  - v2 winrate 42.07% / v1 winrate 28.12% / 29.82%

平均（6席ぶんの v1 平均）:

- v2 約41.87% / v1 約29.07%（v1 は2席合計で約58.1%）

所感: v2 がどの配置でも約42%前後で安定して優位。

## task3 result

play実行時に `logs/` へ自動ログを出力するようにした。

- 形式: `logs/play-YYYYMMDD-HHMMSS.txt`
- 内容: 画面表示、info行、入力プロンプト＋入力内容をそのまま記録
- 先頭に `(setup)` 行として seed/seat/ai/表示オプションを記録
